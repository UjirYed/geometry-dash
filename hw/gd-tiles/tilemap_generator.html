<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Map Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        input, select, button {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            min-width: 100px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .tilemap-container {
            overflow-x: auto;
            padding: 10px;
            background-color: #eee;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .tilemap-grid {
            display: inline-grid;
            gap: 1px;
            background-color: #ccc;
        }
        
        .tile {
            width: 40px;
            height: 40px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .tile:hover {
            background-color: #f0f0f0;
        }
        
        .tile-id {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            background-color: rgba(255,255,255,0.7);
            padding: 1px 3px;
            border-radius: 2px;
        }
        
        .quick-select {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .quick-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        
        .quick-btn.selected {
            border: 2px solid #0066cc;
        }
        
        .export-section textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            resize: vertical;
        }
        
        .visualization-options {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .coordinate-display {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            z-index: 100;
        }
        
        /* Toggle switch styling */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #2196F3;
        }
        
        input:checked + .slider:before {
            transform: translateX(36px);
        }
    </style>
</head>
<body>
    <h1>Tile Map Generator</h1>
    
    <div class="container">
        <div class="section">
            <h2>Tile Map Settings</h2>
            <div class="controls">
                <div class="control-group">
                    <label for="map-width">Map Width (tiles):</label>
                    <input type="number" id="map-width" min="1" max="100" value="20">
                </div>
                
                <div class="control-group">
                    <label for="current-tile">Current Tile ID (0-255):</label>
                    <input type="number" id="current-tile" min="0" max="255" value="1">
                </div>
                
                <button id="resize-btn">Resize Map</button>
                <button id="clear-btn">Clear Map</button>
                <button id="fill-btn">Fill with Current ID</button>
            </div>
            
            <div>
                <h3>Quick Select Tiles</h3>
                <div class="quick-select" id="quick-select"></div>
            </div>
        </div>
        
        <div class="section">
            <h2>Tile Map</h2>
            <div class="visualization-options">
                <label class="switch">
                    <input type="checkbox" id="show-ids" checked>
                    <span class="slider"></span>
                </label>
                <span>Show Tile IDs</span>
            </div>
            <div class="tilemap-container">
                <div class="tilemap-grid" id="tilemap"></div>
            </div>
            <div id="coordinate-display" class="coordinate-display">X: 0, Y: 0</div>
        </div>
        
        <div class="section export-section">
            <h2>Export Tile Map</h2>
            <div class="controls">
                <select id="export-format">
                    <option value="hex">Hexadecimal (0x00-0xFF)</option>
                    <option value="decimal">Decimal (0-255)</option>
                    <option value="binary">Binary (00000000-11111111)</option>
                    <option value="csv">CSV</option>
                    <option value="json">JSON</option>
                    <option value="c-array">C Array</option>
                </select>
                <button id="export-btn">Export Tile Map</button>
            </div>
            <textarea id="export-output" readonly placeholder="Exported tile map data will appear here"></textarea>
        </div>
    </div>
    
    <script>
        // Initialize app state
        const state = {
            mapWidth: 20,
            mapHeight: 15, // Fixed height as per requirements
            currentTileId: 1,
            tileMap: null, // Will be initialized as a 2D array
            quickSelectTiles: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        };
        
        // DOM elements
        const tilemapEl = document.getElementById('tilemap');
        const mapWidthInput = document.getElementById('map-width');
        const currentTileInput = document.getElementById('current-tile');
        const resizeBtn = document.getElementById('resize-btn');
        const clearBtn = document.getElementById('clear-btn');
        const fillBtn = document.getElementById('fill-btn');
        const exportFormatSelect = document.getElementById('export-format');
        const exportBtn = document.getElementById('export-btn');
        const exportOutput = document.getElementById('export-output');
        const quickSelectEl = document.getElementById('quick-select');
        const showIdsCheckbox = document.getElementById('show-ids');
        const coordinateDisplay = document.getElementById('coordinate-display');
        
        // Initialize the tile map data
        function initTileMap() {
            state.tileMap = Array(state.mapHeight).fill().map(() => 
                Array(state.mapWidth).fill(0)
            );
        }
        
        // Initialize the tile map UI
        function renderTileMap() {
            // Set the grid dimensions
            tilemapEl.style.gridTemplateColumns = `repeat(${state.mapWidth}, 40px)`;
            tilemapEl.style.gridTemplateRows = `repeat(${state.mapHeight}, 40px)`;
            
            // Clear existing tiles
            tilemapEl.innerHTML = '';
            
            // Create tiles
            for (let y = 0; y < state.mapHeight; y++) {
                for (let x = 0; x < state.mapWidth; x++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.dataset.x = x;
                    tile.dataset.y = y;
                    
                    // Display tile ID
                    const tileId = document.createElement('div');
                    tileId.className = 'tile-id';
                    tileId.textContent = state.tileMap[y][x];
                    tile.appendChild(tileId);
                    
                    // Set background color based on tile ID (simple visualization)
                    const hue = (state.tileMap[y][x] * 25) % 360;
                    tile.style.backgroundColor = `hsl(${hue}, 80%, 85%)`;
                    
                    // Add event listeners for painting
                    tile.addEventListener('mousedown', (e) => {
                        // Left click to paint
                        if (e.button === 0) {
                            state.tileMap[y][x] = state.currentTileId;
                            updateTile(tile, state.currentTileId);
                        }
                    });
                    
                    tile.addEventListener('mouseover', (e) => {
                        // Update coordinate display
                        coordinateDisplay.textContent = `X: ${x}, Y: ${y}, ID: ${state.tileMap[y][x]}`;
                        
                        // Paint on drag (when mouse button is pressed)
                        if (e.buttons === 1) {
                            state.tileMap[y][x] = state.currentTileId;
                            updateTile(tile, state.currentTileId);
                        }
                    });
                    
                    // Add to the grid
                    tilemapEl.appendChild(tile);
                }
            }
            
            // Update tile ID visibility
            updateTileIdVisibility();
        }
        
        // Update a single tile appearance
        function updateTile(tileEl, tileId) {
            const tileIdEl = tileEl.querySelector('.tile-id');
            tileIdEl.textContent = tileId;
            
            // Update background color
            const hue = (tileId * 25) % 360;
            tileEl.style.backgroundColor = `hsl(${hue}, 80%, 85%)`;
        }
        
        // Update all tiles based on the current tile map data
        function updateAllTiles() {
            const tiles = tilemapEl.querySelectorAll('.tile');
            tiles.forEach(tile => {
                const x = parseInt(tile.dataset.x);
                const y = parseInt(tile.dataset.y);
                if (state.tileMap[y] && state.tileMap[y][x] !== undefined) {
                    updateTile(tile, state.tileMap[y][x]);
                }
            });
        }
        
        // Initialize quick select buttons
        function initQuickSelect() {
            quickSelectEl.innerHTML = '';
            
            state.quickSelectTiles.forEach(tileId => {
                const btn = document.createElement('div');
                btn.className = 'quick-btn';
                if (tileId === state.currentTileId) {
                    btn.classList.add('selected');
                }
                
                // Set the button appearance
                const hue = (tileId * 25) % 360;
                btn.style.backgroundColor = `hsl(${hue}, 80%, 85%)`;
                btn.textContent = tileId;
                
                btn.addEventListener('click', () => {
                    state.currentTileId = tileId;
                    currentTileInput.value = tileId;
                    updateQuickSelectHighlight();
                });
                
                quickSelectEl.appendChild(btn);
            });
        }
        
        // Update quick select button highlighting
        function updateQuickSelectHighlight() {
            const buttons = quickSelectEl.querySelectorAll('.quick-btn');
            buttons.forEach(btn => {
                if (parseInt(btn.textContent) === state.currentTileId) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
        }
        
        // Toggle tile ID visibility
        function updateTileIdVisibility() {
            const tileIds = document.querySelectorAll('.tile-id');
            tileIds.forEach(id => {
                id.style.display = showIdsCheckbox.checked ? 'block' : 'none';
            });
        }
        
        // Resize the tile map
        function resizeTileMap() {
            const newWidth = parseInt(mapWidthInput.value);
            if (isNaN(newWidth) || newWidth < 1 || newWidth > 100) {
                alert('Please enter a valid width between 1 and 100.');
                mapWidthInput.value = state.mapWidth;
                return;
            }
            
            // Create new tile map with the new dimensions
            const newTileMap = Array(state.mapHeight).fill().map((_, y) => 
                Array(newWidth).fill(0).map((_, x) => 
                    // Copy existing tiles if available
                    (state.tileMap[y] && state.tileMap[y][x] !== undefined) 
                        ? state.tileMap[y][x] 
                        : 0
                )
            );
            
            state.mapWidth = newWidth;
            state.tileMap = newTileMap;
            
            // Re-render the tile map
            renderTileMap();
        }
        
        // Clear the tile map (set all tiles to 0)
        function clearTileMap() {
            state.tileMap = Array(state.mapHeight).fill().map(() => 
                Array(state.mapWidth).fill(0)
            );
            updateAllTiles();
        }
        
        // Fill the tile map with the current tile ID
        function fillTileMap() {
            state.tileMap = Array(state.mapHeight).fill().map(() => 
                Array(state.mapWidth).fill(state.currentTileId)
            );
            updateAllTiles();
        }
        
        // Export the tile map in the selected format
        function exportTileMap() {
            const format = exportFormatSelect.value;
            let output = '';
            
            try {
                switch (format) {
                    case 'hex':
                        output = `// Tile Map (${state.mapWidth}x${state.mapHeight})\n// Format: Hexadecimal (0x00-0xFF)\n\n`;
                        for (let y = 0; y < state.mapHeight; y++) {
                            for (let x = 0; x < state.mapWidth; x++) {
                                output += '0x' + state.tileMap[y][x].toString(16).padStart(2, '0') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'decimal':
                        output = `// Tile Map (${state.mapWidth}x${state.mapHeight})\n// Format: Decimal (0-255)\n\n`;
                        for (let y = 0; y < state.mapHeight; y++) {
                            for (let x = 0; x < state.mapWidth; x++) {
                                output += state.tileMap[y][x].toString().padStart(3, ' ') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'binary':
                        output = `// Tile Map (${state.mapWidth}x${state.mapHeight})\n// Format: Binary (00000000-11111111)\n\n`;
                        for (let y = 0; y < state.mapHeight; y++) {
                            for (let x = 0; x < state.mapWidth; x++) {
                                output += state.tileMap[y][x].toString(2).padStart(8, '0') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'csv':
                        output = `# Tile Map (${state.mapWidth}x${state.mapHeight})\n`;
                        for (let y = 0; y < state.mapHeight; y++) {
                            output += state.tileMap[y].join(',') + '\n';
                        }
                        break;
                        
                    case 'json':
                        output = JSON.stringify({
                            width: state.mapWidth,
                            height: state.mapHeight,
                            tileMap: state.tileMap
                        }, null, 2);
                        break;
                        
                    case 'c-array':
                        output = `// Tile Map (${state.mapWidth}x${state.mapHeight})\n\n`;
                        output += `#define MAP_WIDTH ${state.mapWidth}\n`;
                        output += `#define MAP_HEIGHT ${state.mapHeight}\n\n`;
                        output += `const uint8_t tileMap[${state.mapHeight}][${state.mapWidth}] = {\n`;
                        
                        for (let y = 0; y < state.mapHeight; y++) {
                            output += '    {';
                            for (let x = 0; x < state.mapWidth; x++) {
                                output += state.tileMap[y][x];
                                if (x < state.mapWidth - 1) {
                                    output += ', ';
                                }
                            }
                            output += '}';
                            if (y < state.mapHeight - 1) {
                                output += ',';
                            }
                            output += '\n';
                        }
                        
                        output += '};\n';
                        break;
                }
            } catch (error) {
                output = `Error generating output: ${error.message}\n\nPlease try again.`;
            }
            
            exportOutput.value = output;
        }
        
        // Event listeners
        mapWidthInput.addEventListener('change', () => {
            const value = parseInt(mapWidthInput.value);
            if (value < 1) mapWidthInput.value = 1;
            if (value > 100) mapWidthInput.value = 100;
        });
        
        currentTileInput.addEventListener('change', () => {
            const value = parseInt(currentTileInput.value);
            if (value < 0) currentTileInput.value = 0;
            if (value > 255) currentTileInput.value = 255;
            state.currentTileId = parseInt(currentTileInput.value);
            updateQuickSelectHighlight();
        });
        
        resizeBtn.addEventListener('click', resizeTileMap);
        clearBtn.addEventListener('click', clearTileMap);
        fillBtn.addEventListener('click', fillTileMap);
        exportBtn.addEventListener('click', exportTileMap);
        showIdsCheckbox.addEventListener('change', updateTileIdVisibility);
        
        // Prevent default drag behavior
        document.addEventListener('dragstart', (e) => e.preventDefault());
        
        // Hide coordinate display when not over the tile map
        document.addEventListener('mousemove', (e) => {
            const isOverTileMap = e.target.closest('.tilemap-grid') !== null;
            coordinateDisplay.style.display = isOverTileMap ? 'block' : 'none';
        });
        
        // Initialize the application
        initTileMap();
        renderTileMap();
        initQuickSelect();
    </script>
</body>
</html>
