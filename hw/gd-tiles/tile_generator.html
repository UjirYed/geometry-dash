<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16-Color Palette Matrix Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .palette-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .color-box {
            height: 60px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .color-box.selected {
            border: 2px solid #000;
        }
        
        .color-index {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(255,255,255,0.7);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .color-input {
            margin-top: 5px;
            width: 100%;
        }
        
        .matrix-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(32, 1fr);
            grid-template-rows: repeat(32, 1fr);
            gap: 1px;
            width: 480px;
            height: 480px;
            background-color: #ddd;
            border: 1px solid #ccc;
        }
        
        .matrix-cell {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .control-panel {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .export-section {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .format-select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        .preset-palettes {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>16-Color Palette Matrix Editor</h1>
    
    <div class="container">
        <div class="section">
            <h2>Color Palette</h2>
            <p>Select a color (0-15) to edit its RGB value or click on the matrix to paint with the selected color.</p>
            
            <div class="preset-palettes">
                <button id="default-palette">Default Palette</button>
                <button id="grayscale-palette">Grayscale Palette</button>
                <button id="retro-palette">Retro Palette</button>
            </div>
            
            <div class="palette-grid" id="palette">
                <!-- Palette color boxes will be generated here -->
            </div>
        </div>
        
        <div class="section">
            <h2>32x32 Matrix</h2>
            <div class="matrix-container">
                <div class="matrix-grid" id="matrix">
                    <!-- Matrix cells will be generated here -->
                </div>
                
                <div class="control-panel">
                    <button id="clear-btn">Clear Matrix</button>
                    <button id="fill-btn">Fill with Selected Color</button>
                    <button id="random-btn">Random Fill</button>
                </div>
            </div>
        </div>
        
        <div class="section export-section">
            <h2>Export Data</h2>
            <div class="controls">
                <select id="format-select" class="format-select">
                    <option value="hex">Hexadecimal (0x00-0x0F)</option>
                    <option value="binary">Binary (0000-1111)</option>
                    <option value="decimal">Decimal (0-15)</option>
                    <option value="json">JSON</option>
                </select>
                <button id="export-btn">Export Matrix Data</button>
                <button id="export-palette-btn">Export Palette</button>
            </div>
            <textarea id="export-output" readonly placeholder="Exported data will appear here"></textarea>
        </div>
    </div>
    
    <script>
        // Initialize app state
        const state = {
            selectedColorIndex: 0,
            palette: Array(16).fill().map((_, i) => {
                // Generate a basic default palette
                if (i === 0) return "#000000"; // Black
                if (i === 15) return "#FFFFFF"; // White
                return `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;
            }),
            matrix: Array(32).fill().map(() => Array(32).fill(0)) // Initialize with color 0
        };
        
        // Create a deep copy of the matrix for safety
        state.matrix = JSON.parse(JSON.stringify(state.matrix));

        // DOM elements
        const paletteEl = document.getElementById('palette');
        const matrixEl = document.getElementById('matrix');
        const exportOutputEl = document.getElementById('export-output');
        const formatSelectEl = document.getElementById('format-select');
        const exportBtn = document.getElementById('export-btn');
        const exportPaletteBtn = document.getElementById('export-palette-btn');
        const clearBtn = document.getElementById('clear-btn');
        const fillBtn = document.getElementById('fill-btn');
        const randomBtn = document.getElementById('random-btn');
        const defaultPaletteBtn = document.getElementById('default-palette');
        const grayscalePaletteBtn = document.getElementById('grayscale-palette');
        const retroPaletteBtn = document.getElementById('retro-palette');

        // Initialize palette UI
        function initPalette() {
            paletteEl.innerHTML = '';
            state.palette.forEach((color, index) => {
                const colorBox = document.createElement('div');
                colorBox.className = `color-box ${index === state.selectedColorIndex ? 'selected' : ''}`;
                colorBox.style.backgroundColor = color;
                
                const colorIndex = document.createElement('div');
                colorIndex.className = 'color-index';
                colorIndex.textContent = index.toString(16).toUpperCase();
                
                const colorInput = document.createElement('input');
                colorInput.type = 'color';
                colorInput.className = 'color-input';
                colorInput.value = color;
                colorInput.addEventListener('input', (e) => {
                    state.palette[index] = e.target.value;
                    colorBox.style.backgroundColor = e.target.value;
                    updateMatrix();
                });
                
                colorBox.appendChild(colorIndex);
                colorBox.appendChild(colorInput);
                
                colorBox.addEventListener('click', () => {
                    document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
                    colorBox.classList.add('selected');
                    state.selectedColorIndex = index;
                });
                
                paletteEl.appendChild(colorBox);
            });
        }

        // Initialize matrix UI
        function initMatrix() {
            matrixEl.innerHTML = '';
            for (let y = 0; y < 32; y++) {
                for (let x = 0; x < 32; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.style.backgroundColor = state.palette[state.matrix[y][x]];
                    
                    // Paint with selected color on click
                    cell.addEventListener('click', () => {
                        state.matrix[y][x] = state.selectedColorIndex;
                        cell.style.backgroundColor = state.palette[state.selectedColorIndex];
                    });
                    
                    // Paint with selected color on drag
                    cell.addEventListener('mouseover', (e) => {
                        if (e.buttons === 1) {
                            state.matrix[y][x] = state.selectedColorIndex;
                            cell.style.backgroundColor = state.palette[state.selectedColorIndex];
                        }
                    });
                    
                    matrixEl.appendChild(cell);
                }
            }
        }

        // Update matrix colors based on the current palette
        function updateMatrix() {
            const cells = matrixEl.querySelectorAll('.matrix-cell');
            cells.forEach(cell => {
                const x = parseInt(cell.dataset.x);
                const y = parseInt(cell.dataset.y);
                if (!isNaN(x) && !isNaN(y) && state.matrix[y] && state.matrix[y][x] !== undefined) {
                    cell.style.backgroundColor = state.palette[state.matrix[y][x]];
                }
            });
        }

        // Export matrix data in the selected format
        function exportMatrixData() {
            const format = formatSelectEl.value;
            let output = '';
            
            try {
                switch (format) {
                    case 'hex':
                        output = 'Matrix data (hex values 0x00-0x0F):\n\n';
                        for (let y = 0; y < 32; y++) {
                            for (let x = 0; x < 32; x++) {
                                const value = state.matrix[y][x] || 0;
                                output += '0x' + value.toString(16).padStart(2, '0') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'binary':
                        output = 'Matrix data (binary values 0000-1111):\n\n';
                        for (let y = 0; y < 32; y++) {
                            for (let x = 0; x < 32; x++) {
                                const value = state.matrix[y][x] || 0;
                                output += value.toString(2).padStart(4, '0') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'decimal':
                        output = 'Matrix data (decimal values 0-15):\n\n';
                        for (let y = 0; y < 32; y++) {
                            for (let x = 0; x < 32; x++) {
                                const value = state.matrix[y][x] || 0;
                                output += value.toString().padStart(2, ' ') + ' ';
                            }
                            output += '\n';
                        }
                        break;
                        
                    case 'json':
                        output = JSON.stringify({
                            palette: state.palette,
                            matrix: state.matrix
                        }, null, 2);
                        break;
                }
            } catch (error) {
                output = `Error generating output: ${error.message}\n\nPlease try clearing the matrix and starting over.`;
            }
            
            exportOutputEl.value = output;
        }

        // Export palette data
        function exportPaletteData() {
            let output = 'Color Palette (RGB Values):\n\n';
            state.palette.forEach((color, index) => {
                // Convert hex to RGB
                const r = parseInt(color.slice(1, 3), 16);
                const g = parseInt(color.slice(3, 5), 16);
                const b = parseInt(color.slice(5, 7), 16);
                
                output += `Color ${index.toString(16).toUpperCase()}: ${color} (RGB: ${r}, ${g}, ${b})\n`;
            });
            
            exportOutputEl.value = output;
        }

        // Clear the matrix (set all cells to color 0)
        function clearMatrix() {
            // Recreate the matrix to ensure it's properly structured
            state.matrix = Array(32).fill().map(() => Array(32).fill(0));
            updateMatrix();
        }

        // Fill matrix with selected color
        function fillMatrix() {
            for (let y = 0; y < 32; y++) {
                for (let x = 0; x < 32; x++) {
                    state.matrix[y][x] = state.selectedColorIndex;
                }
            }
            updateMatrix();
        }

        // Fill matrix with random colors
        function randomFill() {
            for (let y = 0; y < 32; y++) {
                for (let x = 0; x < 32; x++) {
                    state.matrix[y][x] = Math.floor(Math.random() * 16);
                }
            }
            updateMatrix();
        }

        // Load default palette
        function loadDefaultPalette() {
            state.palette = [
                "#000000", // Black
                "#0000AA", // Dark Blue
                "#00AA00", // Dark Green
                "#00AAAA", // Dark Cyan
                "#AA0000", // Dark Red
                "#AA00AA", // Dark Magenta
                "#AA5500", // Brown
                "#AAAAAA", // Light Gray
                "#555555", // Dark Gray
                "#5555FF", // Blue
                "#55FF55", // Green
                "#55FFFF", // Cyan
                "#FF5555", // Red
                "#FF55FF", // Magenta
                "#FFFF55", // Yellow
                "#FFFFFF"  // White
            ];
            initPalette();
            updateMatrix();
        }

        // Load grayscale palette
        function loadGrayscalePalette() {
            state.palette = Array(16).fill().map((_, i) => {
                const value = Math.floor(i * 17).toString(16).padStart(2, '0');
                return `#${value}${value}${value}`;
            });
            initPalette();
            updateMatrix();
        }

        // Load retro palette
        function loadRetroPalette() {
            state.palette = [
                "#2C2137", // Dark Purple
                "#764462", // Muted Purple
                "#A96868", // Dusty Rose
                "#F5D087", // Sand
                "#9BABB2", // Steel Blue
                "#8BF5CA", // Mint
                "#323F61", // Navy
                "#743C5F", // Burgundy
                "#7D5D4F", // Brown
                "#BC8A5F", // Tan
                "#D8AF7D", // Light Tan
                "#7BB24B", // Olive Green
                "#4E8699", // Teal
                "#67B8D4", // Light Blue
                "#E94545", // Red
                "#EBD5B1"  // Cream
            ];
            initPalette();
            updateMatrix();
        }

        // Bind event listeners
        exportBtn.addEventListener('click', exportMatrixData);
        exportPaletteBtn.addEventListener('click', exportPaletteData);
        clearBtn.addEventListener('click', clearMatrix);
        fillBtn.addEventListener('click', fillMatrix);
        randomBtn.addEventListener('click', randomFill);
        defaultPaletteBtn.addEventListener('click', loadDefaultPalette);
        grayscalePaletteBtn.addEventListener('click', loadGrayscalePalette);
        retroPaletteBtn.addEventListener('click', loadRetroPalette);

        // Prevent default drag behavior
        document.addEventListener('dragstart', (e) => e.preventDefault());

        // Initialize application
        loadDefaultPalette();
        initMatrix();
    </script>
</body>
</html>
